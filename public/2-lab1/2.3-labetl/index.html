<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.125.3">
    <meta name="description" content="">
<meta name="author" content="journeyoftheaverageguy@gmail.com">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Lab. Streaming ETL with Glue  :: AWS System Manager</title>

    
    <link href="/css/nucleus.css?1713922703" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1713922703" rel="stylesheet">
    <link href="/css/hybrid.css?1713922703" rel="stylesheet">
    <link href="/css/featherlight.min.css?1713922703" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1713922703" rel="stylesheet">
    <link href="/css/auto-complete.css?1713922703" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1713922703" rel="stylesheet">
    <link href="/css/theme.css?1713922703" rel="stylesheet">
    <link href="/css/hugo-theme.css?1713922703" rel="stylesheet">
    
    <link href="/css/theme-workshop.css?1713922703" rel="stylesheet">
    
    

    <script src="/js/jquery-3.3.1.min.js?1713922703"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/2-lab1/2.3-labetl/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">

<svg id="Layer_1" data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 60 30" width="30%"><defs><style>.cls-1{fill:#fff;}.cls-2{fill:#f90;fill-rule:evenodd;}</style></defs><title>AWS-Logo_White-Color</title><path class="cls-1" d="M14.09,10.85a4.7,4.7,0,0,0,.19,1.48,7.73,7.73,0,0,0,.54,1.19.77.77,0,0,1,.12.38.64.64,0,0,1-.32.49l-1,.7a.83.83,0,0,1-.44.15.69.69,0,0,1-.49-.23,3.8,3.8,0,0,1-.6-.77q-.25-.42-.51-1a6.14,6.14,0,0,1-4.89,2.3,4.54,4.54,0,0,1-3.32-1.19,4.27,4.27,0,0,1-1.22-3.2A4.28,4.28,0,0,1,3.61,7.75,6.06,6.06,0,0,1,7.69,6.46a12.47,12.47,0,0,1,1.76.13q.92.13,1.91.36V5.73a3.65,3.65,0,0,0-.79-2.66A3.81,3.81,0,0,0,7.86,2.3a7.71,7.71,0,0,0-1.79.22,12.78,12.78,0,0,0-1.79.57,4.55,4.55,0,0,1-.58.22l-.26,0q-.35,0-.35-.52V2a1.09,1.09,0,0,1,.12-.58,1.2,1.2,0,0,1,.47-.35A10.88,10.88,0,0,1,5.77.32,10.19,10.19,0,0,1,8.36,0a6,6,0,0,1,4.35,1.35,5.49,5.49,0,0,1,1.38,4.09ZM7.34,13.38a5.36,5.36,0,0,0,1.72-.31A3.63,3.63,0,0,0,10.63,12,2.62,2.62,0,0,0,11.19,11a5.63,5.63,0,0,0,.16-1.44v-.7a14.35,14.35,0,0,0-1.53-.28,12.37,12.37,0,0,0-1.56-.1,3.84,3.84,0,0,0-2.47.67A2.34,2.34,0,0,0,5,11a2.35,2.35,0,0,0,.61,1.76A2.4,2.4,0,0,0,7.34,13.38Zm13.35,1.8a1,1,0,0,1-.64-.16,1.3,1.3,0,0,1-.35-.65L15.81,1.51a3,3,0,0,1-.15-.67.36.36,0,0,1,.41-.41H17.7a1,1,0,0,1,.65.16,1.4,1.4,0,0,1,.33.65l2.79,11,2.59-11A1.17,1.17,0,0,1,24.39.6a1.1,1.1,0,0,1,.67-.16H26.4a1.1,1.1,0,0,1,.67.16,1.17,1.17,0,0,1,.32.65L30,12.39,32.88,1.25A1.39,1.39,0,0,1,33.22.6a1,1,0,0,1,.65-.16h1.54a.36.36,0,0,1,.41.41,1.36,1.36,0,0,1,0,.26,3.64,3.64,0,0,1-.12.41l-4,12.86a1.3,1.3,0,0,1-.35.65,1,1,0,0,1-.64.16H29.25a1,1,0,0,1-.67-.17,1.26,1.26,0,0,1-.32-.67L25.67,3.64,23.11,14.34a1.26,1.26,0,0,1-.32.67,1,1,0,0,1-.67.17Zm21.36.44a11.28,11.28,0,0,1-2.56-.29,7.44,7.44,0,0,1-1.92-.67,1,1,0,0,1-.61-.93v-.84q0-.52.38-.52a.9.9,0,0,1,.31.06l.42.17a8.77,8.77,0,0,0,1.83.58,9.78,9.78,0,0,0,2,.2,4.48,4.48,0,0,0,2.43-.55,1.76,1.76,0,0,0,.86-1.57,1.61,1.61,0,0,0-.45-1.16A4.29,4.29,0,0,0,43,9.22l-2.41-.76A5.15,5.15,0,0,1,38,6.78a3.94,3.94,0,0,1-.83-2.41,3.7,3.7,0,0,1,.45-1.85,4.47,4.47,0,0,1,1.19-1.37A5.27,5.27,0,0,1,40.51.29,7.4,7.4,0,0,1,42.6,0a8.87,8.87,0,0,1,1.12.07q.57.07,1.08.19t.95.26a4.27,4.27,0,0,1,.7.29,1.59,1.59,0,0,1,.49.41.94.94,0,0,1,.15.55v.79q0,.52-.38.52a1.76,1.76,0,0,1-.64-.2,7.74,7.74,0,0,0-3.2-.64,4.37,4.37,0,0,0-2.21.47,1.6,1.6,0,0,0-.79,1.48,1.58,1.58,0,0,0,.49,1.18,4.94,4.94,0,0,0,1.83.92L44.55,7a5.08,5.08,0,0,1,2.57,1.6A3.76,3.76,0,0,1,47.9,11a4.21,4.21,0,0,1-.44,1.93,4.4,4.4,0,0,1-1.21,1.47,5.43,5.43,0,0,1-1.85.93A8.25,8.25,0,0,1,42.05,15.62Z"></path><path class="cls-2" d="M45.19,23.81C39.72,27.85,31.78,30,25,30A36.64,36.64,0,0,1,.22,20.57c-.51-.46-.06-1.09.56-.74A49.78,49.78,0,0,0,25.53,26.4,49.23,49.23,0,0,0,44.4,22.53C45.32,22.14,46.1,23.14,45.19,23.81Z"></path><path class="cls-2" d="M47.47,21.21c-.7-.9-4.63-.42-6.39-.21-.53.06-.62-.4-.14-.74,3.13-2.2,8.27-1.57,8.86-.83s-.16,5.89-3.09,8.35c-.45.38-.88.18-.68-.32C46.69,25.8,48.17,22.11,47.47,21.21Z"></path></svg>

</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1713922703"></script>
<script type="text/javascript" src="/js/auto-complete.js?1713922703"></script>
<script type="text/javascript">
    
        var baseurl = "\/\/localhost:1313\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1713922703"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/1-introduce/" title="Giới thiệu" class="dd-item 
        
        
        
        ">
      <a href="/1-introduce/">
           <b> 1. </b> Giới thiệu
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/2-lab1/" title="Lab. Phát hiện luồng click chuột bất thường bằng Amazon Managed Service for Apache Flink" class="dd-item 
        parent
        
        
        ">
      <a href="/2-lab1/">
           <b> 2 </b> Lab. Phát hiện luồng click chuột bất thường bằng Amazon Managed Service for Apache Flink
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/2-lab1/2.1-prepare/" title="Phát hiện luồng click chuột bất thường bằng Amazon Managed Service for Apache Flink" class="dd-item 
        
        
        
        ">
      <a href="/2-lab1/2.1-prepare/">
           <b> 2.1 </b> Phát hiện luồng click chuột bất thường bằng Amazon Managed Service for Apache Flink
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-lab1/2.2-lab/" title="Lab" class="dd-item 
        
        
        
        ">
      <a href="/2-lab1/2.2-lab/">
           <b> 2.2 </b> Lab
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-lab1/2.3-labetl/" title="Lab. Streaming ETL with Glue " class="dd-item 
        
        active
        
        ">
      <a href="/2-lab1/2.3-labetl/">
           <b> 2.3 </b> Lab. Streaming ETL with Glue 
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-lab1/2.4-kinesis/" title="Real-time Streaming with Kinesis" class="dd-item 
        
        
        
        ">
      <a href="/2-lab1/2.4-kinesis/">
           <b> 2.4 </b> Real-time Streaming with Kinesis
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/2-lab1/2.5-msk/" title="Clickstream Analytics using MSK" class="dd-item 
        
        
        
        ">
      <a href="/2-lab1/2.5-msk/">
           <b> 2.5 </b> Clickstream Analytics using MSK
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/3-ingestionwithdms/" title="Nhập data với DMS" class="dd-item 
        
        
        
        ">
      <a href="/3-ingestionwithdms/">
           <b> 3. </b> Nhập data với DMS
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/3-ingestionwithdms/3.1-dms-migration-lab/" title=" Option1: DMS Migration Lab" class="dd-item 
        
        
        
        ">
      <a href="/3-ingestionwithdms/3.1-dms-migration-lab/">
           <b> 3.1. </b>  Option1: DMS Migration Lab
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-ingestionwithdms/3.3-skip-dms-lab/" title="Option 2: AutoComplete DMS Lab" class="dd-item 
        
        
        
        ">
      <a href="/3-ingestionwithdms/3.3-skip-dms-lab/">
           <b> 3.2. </b> Option 2: AutoComplete DMS Lab
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/3-ingestionwithdms/3.2-private-instance/" title="Option 3: Skip DMS Lab" class="dd-item 
        
        
        
        ">
      <a href="/3-ingestionwithdms/3.2-private-instance/">
           <b> 3.2. </b> Option 3: Skip DMS Lab
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/4-transformingdatawithglue/" title="Lab: Transforming data with Glue" class="dd-item 
        
        
        
        ">
      <a href="/4-transformingdatawithglue/">
           <b> 4. </b> Lab: Transforming data with Glue
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/4-transformingdatawithglue/4.1-datavalidationandetl/" title="Data Validation and ETL" class="dd-item 
        
        
        
        ">
      <a href="/4-transformingdatawithglue/4.1-datavalidationandetl/">
           <b> 4.1 </b> Data Validation and ETL
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-transformingdatawithglue/4.2-hudi/" title="Incremental Data Processing with Hudi" class="dd-item 
        
        
        
        ">
      <a href="/4-transformingdatawithglue/4.2-hudi/">
           <b> 4.2 </b> Incremental Data Processing with Hudi
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-transformingdatawithglue/4.3-gluejobbookmark/" title="Glue Job Bookmark (Optional)" class="dd-item 
        
        
        
        ">
      <a href="/4-transformingdatawithglue/4.3-gluejobbookmark/">
           <b> 4.3 </b> Glue Job Bookmark (Optional)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/4-transformingdatawithglue/4.4-glueworkflows/" title="Glue Workflows (Optional)" class="dd-item 
        
        
        
        ">
      <a href="/4-transformingdatawithglue/4.4-glueworkflows/">
           <b> 4.4 </b> Glue Workflows (Optional)
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/5-labqueryandvisualize/" title="Lab: Query and Visualize" class="dd-item 
        
        
        
        ">
      <a href="/5-labqueryandvisualize/">
           <b> 5. </b> Lab: Query and Visualize
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/5-labqueryandvisualize/5.1-athenaandquicksight/" title="Athena and QuickSight" class="dd-item 
        
        
        
        ">
      <a href="/5-labqueryandvisualize/5.1-athenaandquicksight/">
           <b> 5.1 </b> Athena and QuickSight
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-labqueryandvisualize/5.2-athenafederatedquery/" title="Athena Federated query" class="dd-item 
        
        
        
        ">
      <a href="/5-labqueryandvisualize/5.2-athenafederatedquery/">
           <b> 5.2 </b> Athena Federated query
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/5-labqueryandvisualize/5.3-athenaandsagemaker/" title="Athena and SageMaker" class="dd-item 
        
        
        
        ">
      <a href="/5-labqueryandvisualize/5.3-athenaandsagemaker/">
           <b> 5.3 </b> Athena and SageMaker
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/6-labdatalakeautomation/" title="Lab: Data Lake Automation" class="dd-item 
        
        
        
        ">
      <a href="/6-labdatalakeautomation/">
          <b>6. </b>Lab: Data Lake Automation
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/6-labdatalakeautomation/6.1-lakeformationlab/" title="Lake Formation Lab" class="dd-item 
        
        
        
        ">
      <a href="/6-labdatalakeautomation/6.1-lakeformationlab/">
           <b> 6.1 </b> Lake Formation Lab
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/6-labdatalakeautomation/6.2-lakeformationlabforapachehuditables/" title="Lake Formation Lab for Apache Hudi Tables" class="dd-item 
        
        
        
        ">
      <a href="/6-labdatalakeautomation/6.2-lakeformationlabforapachehuditables/">
           <b> 6.2 </b> Lake Formation Lab for Apache Hudi Tables
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/6-labdatalakeautomation/6.3-lakeformationlabforapacheicebergtables/" title="Lake Formation Lab for Apache Iceberg Tables" class="dd-item 
        
        
        
        ">
      <a href="/6-labdatalakeautomation/6.3-lakeformationlabforapacheicebergtables/">
           <b> 6.3 </b> Lake Formation Lab for Apache Iceberg Tables
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/6-labdatalakeautomation/6.4-lakeformationlabordeltatables/" title="Lake Formation Lab for Delta Tables" class="dd-item 
        
        
        
        ">
      <a href="/6-labdatalakeautomation/6.4-lakeformationlabordeltatables/">
           <b> 6.4 </b> Lake Formation Lab for Delta Tables
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/7-bonuslabgluedatabrew/" title="Bonus Lab: Glue DataBrew" class="dd-item 
        
        
        
        ">
      <a href="/7-bonuslabgluedatabrew/">
          <b>7. </b>Bonus Lab: Glue DataBrew
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            




 
  
    
    <li data-nav-id="/7-bonuslabgluedatabrew/7.1-databrewpre-lab/" title="DataBrew Pre-Lab" class="dd-item 
        
        
        
        ">
      <a href="/7-bonuslabgluedatabrew/7.1-databrewpre-lab/">
           <b> 7.1 </b> DataBrew Pre-Lab
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
            
            




 
  
    
    <li data-nav-id="/7-bonuslabgluedatabrew/7.2-datapreparationwithgluedatabrew/" title="Data preparation with Glue DataBrew" class="dd-item 
        
        
        
        ">
      <a href="/7-bonuslabgluedatabrew/7.2-datapreparationwithgluedatabrew/">
           <b> 7.2 </b> Data preparation with Glue DataBrew
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://www.facebook.com/groups/awsstudygroupfcj/"><i class='fab fa-facebook'></i> AWS Study Group</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <left>
    
     <b> Workshop</b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7920860&style=0038&nbdigits=9&type=page&initCount=0" title="Migrate" Alt="web counter"   border="0" /></a>  <br>
     <b> <a href="https://cloudjourney.awsstudygroup.com/">Cloud Journey</a></b> <br>
    <img src="https://hitwebcounter.com/counter/counter.php?page=7830807&style=0038&nbdigits=9&type=page&initCount=0" title="Total CLoud Journey" Alt="web counter"   border="0"   />
     
</left>
<left>
    <br>
    <br>
        <b> Last Updated </b> <br>
        <i><font color=orange>23-04-2024</font></i>
    </left>
    <left>
        <br>
        <br>
            <b> Team </b> <br>
           
            <i> <a href="https://www.linkedin.com/in/sutrinh/"  style="color:orange">Sử Trịnh  </a> <br>
                <a href="https://www.linkedin.com/in/jotaguy"  style="color:orange">Gia Hưng </a> <br>
               
        </i>
        </left>

<script async defer src="https://buttons.github.io/buttons.js"></script>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Data Engineering Immersion Day</a> > <a href='/2-lab1/'>Lab. Phát hiện luồng click chuột bất thường bằng Amazon Managed Service for Apache Flink</a> > Lab. Streaming ETL with Glue 
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#giới-thiệu">Giới thiệu</a></li>
        <li><a href="#setup-môi-trường">Setup môi trường</a></li>
        <li><a href="#set-up--kinesis-stream">Set up  kinesis stream</a></li>
        <li><a href="#create-table-for-kinesis-stream-source-in-glue-data-catalog">Create Table for Kinesis Stream Source in Glue Data Catalog</a></li>
        <li><a href="#tạo-và-trigger-glue-streaming-job">Tạo và trigger Glue Streaming job</a></li>
        <li><a href="#trigger-streaming-data-từ-kinesis-data-generator">Trigger streaming data từ Kinesis Data Generator</a></li>
        <li><a href="#tạo-glue-crawler-để-transformed-data">Tạo Glue Crawler để transformed data</a></li>
        <li><a href="#trigger-dữ-liệu-bất-thường-từ-kinesis-data-generatorkdg">Trigger dữ liệu bất thường từ Kinesis Data Generator(KDG)</a></li>
        <li><a href="#sử-dụng-athena-để-truy-vấn-dữ-liệu">Sử dụng Athena để truy vấn dữ liệu</a></li>
      </ul>
    </li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Lab. Streaming ETL with Glue 
            </h1>
          

        



	<h3 id="giới-thiệu">Giới thiệu</h3>
<p>Trong bài lab này, ta sẽ tìm hiểu cách nhập, xử lý và sử dụng streaming data  bằng các dịch vụ serverless của AWS như Kinesis Data Streams, Glue, S3 và Athena. Để mô phỏng đầu vào truyền dữ liệu, chúng tôi sẽ sử dụng Kinesis Data Generator (KDG).</p>
<p><img alt="DeployCF" src="/images/3.connect/1.png"></p>
<h3 id="setup-môi-trường">Setup môi trường</h3>
<p>Sử dụng <a href="https://catalog.us-east-1.prod.workshops.aws/workshops/976050cc-0606-4b23-b49f-ca7b8ac4b153/en-US/400/401/420-pre-lab-2.html">DMS Lab Student PreLab CloudFormation</a> để thiết lập môi trường cơ sở hạ tầng hội thảo cốt lõi của bạn. Bỏ qua PreLab tương tự trong phần DMS. Nhấp vào biểu tượng Triển khai lên AWS bên dưới:</p>

<a  href="https://console.aws.amazon.com/cloudformation/home#/stacks/create/review?stackName=dmslab-student&amp;templateURL=https://s3.amazonaws.com/aws-dataengineering-day.workshop.aws/DMSlab_student_CFN.yaml" target="_blank"  class="btn btn-default">
  
  
  
  Deploy To AWS
  
</a>

<h3 id="set-up--kinesis-stream">Set up  kinesis stream</h3>
<ol>
<li>Mở <a href="https://console.aws.amazon.com/kinesis/home">AWS Kinesis console</a></li>
<li>Chọn “Create data stream”
<img alt="DeployCF" src="/images/3.connect/2.png"></li>
<li>Nhập số liệu như sau:</li>
</ol>
<ul>
<li>Data stream name: TicketTransactionStreamingData</li>
<li>Capacity mode: Provisioned</li>
<li>Provisioned shards: 2</li>
</ul>
<p><img alt="DeployCF" src="/images/3.connect/3.png"></p>
<ol start="4">
<li>Chọn Create data stream</li>
</ol>
<h3 id="create-table-for-kinesis-stream-source-in-glue-data-catalog">Create Table for Kinesis Stream Source in Glue Data Catalog</h3>
<ol>
<li>
<p>Mở tab <a href="https://console.aws.amazon.com/glue/home">AWS Glue console</a></p>
</li>
<li>
<p>Tạo database có tên là &ldquo;tickettransactiondatabase&rdquo;
<img alt="DeployCF" src="/images/3.connect/4.png"></p>
</li>
<li>
<p>Tạo tables có tên là &ldquo;TicketTransactionStreamData&rdquo; ở trong database &ldquo;tickettransactiondatabase&rdquo;
<img alt="DeployCF" src="/images/3.connect/6.png"></p>
</li>
<li>
<p>Chọn Kinesis làm nguồn, chọn Luồng trong my account để chọn luồng dữ liệu Kinesis, chọn khu vực AWS thích hợp nơi bạn đã tạo luồng, chọn tên luồng là TicketTransactionStreamingData từ danh sách thả xuống, chọn JSON làm định dạng dữ liệu đến, vì chúng ta sẽ gửi JSON payloads từ Kinesis Data Generator theo các bước sau. và nhấp vào Tiếp theo.
<img alt="DeployCF" src="/images/3.connect/5.png"></p>
</li>
<li>
<p>Để trống schema vì chúng ta sẽ bật tính năng schema detection. Để trống partition indices. Chọn Next
<img alt="DeployCF" src="/images/3.connect/7.png"></p>
</li>
<li>
<p>Review lại tất cả thông tin và nhấn Create</p>
</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/8.png"></p>
<ol start="7">
<li>Chọn vào Table để xem các thuộc tính</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/9.png"></p>
<h3 id="tạo-và-trigger-glue-streaming-job">Tạo và trigger Glue Streaming job</h3>
<ol>
<li>Tại mục Data Integration and ETL chọn Glue Studio</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/10.png"></p>
<ol start="2">
<li>
<p>Chọn Visual with a blank canvas và nhấn Create
<img alt="DeployCF" src="/images/3.connect/11.png"></p>
</li>
<li>
<p>Chọn Amazon Kinesis từ Source drop down
<img alt="DeployCF" src="/images/3.connect/12.png"></p>
</li>
<li>
<p>Trong bảng bên phải phía dưới “Data source properties - Kinesis Stream”, cấu hình như sau:</p>
</li>
</ol>
<ul>
<li>Amazon Kinesis Source: Data Catalog table</li>
<li>Database: tickettransactiondatabase</li>
<li>Table: tickettransactionstreamdata</li>
<li>Đảm bảo rằng Detect schema được chọn</li>
<li>Để tất cả còn lại mặc định</li>
</ul>
<p><img alt="DeployCF" src="/images/3.connect/13.png"></p>
<ol start="5">
<li>Chọn Amazon S3 từ target drop down list</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/14.png"></p>
<ol start="6">
<li>Chọn <strong>Data target - S3 bucket</strong> và cấu hình như sau:</li>
</ol>
<ul>
<li>Format: Parquet</li>
<li>Compression Type: None</li>
<li>S3 Target Location: Select Browse S3 and select the “mod-xxx-dmslabs3bucket-xxx” bucket
<img alt="DeployCF" src="/images/3.connect/15.png"></li>
</ul>
<ol start="7">
<li>Cuối cùng chọn <strong>Job details</strong> tab và cấu hình theo như sau:</li>
</ol>
<ul>
<li>Name: TicketTransactionStreamingJob</li>
<li>IAM Role: Select the xxx-GlueLabRole-xxx from the drop down list</li>
<li>Type: Spark Streaming</li>
</ul>
<ol start="8">
<li>
<p>Nhấn Save button để tạo job</p>
</li>
<li>
<p>Khi thấy <strong>Successfully created job</strong> ta nhấn <strong>Run</strong> button để start job</p>
</li>
</ol>
<h3 id="trigger-streaming-data-từ-kinesis-data-generator">Trigger streaming data từ Kinesis Data Generator</h3>
<ol>
<li>Truy cập Kinesis Data Generator url từ tab setup và đăng nhập.</li>
<li>Đảm bảo chọn đúng region. Chọn TicketTransactionStreamingData là target Kinesis stream để  Records per second mặc định (100 records per second). Đối với template, nhập NormalTransaction, copy và dán template payload như sau:</li>
</ol>
<pre tabindex="0"><code>{
    &#34;customerId&#34;: &#34;{{random.number(50)}}&#34;,
    &#34;transactionAmount&#34;: {{random.number(
        {
            &#34;min&#34;:10,
            &#34;max&#34;:150
        }
    )}},
    &#34;sourceIp&#34; : &#34;{{internet.ip}}&#34;,
    &#34;status&#34;: &#34;{{random.weightedArrayElement({
        &#34;weights&#34; : [0.8,0.1,0.1],
        &#34;data&#34;: [&#34;OK&#34;,&#34;FAIL&#34;,&#34;PENDING&#34;]
        }        
    )}}&#34;,
   &#34;transactionTime&#34;: &#34;{{date.now}}&#34;      
}
</code></pre><p><img alt="DeployCF" src="/images/3.connect/16.png"></p>
<ol start="3">
<li>Click <strong>Send data</strong> để trigger transaction streaming data.</li>
</ol>
<h3 id="tạo-glue-crawler-để-transformed-data">Tạo Glue Crawler để transformed data</h3>
<ol>
<li>
<p>Truy cập <a href="https://console.aws.amazon.com/glue/home"> AWS Glue console </a></p>
</li>
<li>
<p>Tại AWS Glue menu, chọn Crawlers and click Add crawler</p>
</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/17.png"></p>
<ol start="3">
<li>Nhập tên crawler là  TicketTransactionParquetDataCrawler, nhấn Next</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/18.png"></p>
<ol start="4">
<li>
<p>Click vào Add a datasource
<img alt="DeployCF" src="/images/3.connect/19.png"></p>
</li>
<li>
<p>Chọn S3 và chỉ định path
<img alt="DeployCF" src="/images/3.connect/20.png"></p>
</li>
<li>
<p>Sau khi thêm datasource, nhấn next</p>
</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/21.png"></p>
<ol start="7">
<li>Chọn IAM Role và nhấn Next</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/22.png"></p>
<ol start="8">
<li>Chọn prefix là parquet_ cho tables</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/23.png"></p>
<ol start="9">
<li>
<p>Đăt Crawler Schedule chạy mỗi giờ.
<img alt="DeployCF" src="/images/3.connect/24.png"></p>
</li>
<li>
<p>Review lại  Crawler và Click Create để tạo Crawler
<img alt="DeployCF" src="/images/3.connect/25.png"></p>
</li>
<li>
<p>Sau khi Crawler tạo xong. Nhấn Run crawler để trigger lần đầu.</p>
</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/26.png"></p>
<ol start="12">
<li>Khi crawler job stop, chuyển đến Glue Data catalog. Đảm bảo rằng parquet_tickettransactionstreamingdata table xuất hiện</li>
</ol>
<p><img alt="DeployCF" src="/images/3.connect/27.png"></p>
<ol start="13">
<li>Click vào parquet_tickettransactionstreamingdata table để xem chi tiết
<img alt="DeployCF" src="/images/3.connect/28.png"></li>
</ol>
<h3 id="trigger-dữ-liệu-bất-thường-từ-kinesis-data-generatorkdg">Trigger dữ liệu bất thường từ Kinesis Data Generator(KDG)</h3>
<ol>
<li>
<p>Mở Kinesis Data Generator, chọn đúng region. Chọn TicketTransactionStreamingData là Kinesis stream đích
<img alt="DeployCF" src="/images/3.connect/29.png"></p>
</li>
<li>
<p>Template cho record</p>
</li>
</ol>
<pre tabindex="0"><code>{
    &#34;customerId&#34;: &#34;{{random.number(50)}}&#34;,
    &#34;transactionAmount&#34;: {{random.number(
        {
            &#34;min&#34;:10,
            &#34;max&#34;:150
        }
    )}},
    &#34;sourceIp&#34; : &#34;221.233.116.256&#34;,
    &#34;status&#34;: &#34;{{random.weightedArrayElement({
        &#34;weights&#34; : [0.8,0.1,0.1],
        &#34;data&#34;: [&#34;OK&#34;,&#34;FAIL&#34;,&#34;PENDING&#34;]
        }        
    )}}&#34;,
   &#34;transactionTime&#34;: &#34;{{date.now}}&#34;      
}
</code></pre><p><img alt="DeployCF" src="/images/3.connect/30.png"></p>
<ol start="3">
<li>Click send data</li>
</ol>
<h3 id="sử-dụng-athena-để-truy-vấn-dữ-liệu">Sử dụng Athena để truy vấn dữ liệu</h3>
<ol>
<li>
<p>Mở <a href="https://console.aws.amazon.com/athena/home"> AWS Athena console </a></p>
</li>
<li>
<p>Chọn AwsDataCatalog làm data source và tickettransactiondatabase là database
<img alt="DeployCF" src="/images/3.connect/31.png"></p>
</li>
<li>
<p>Sử dụng các truy vấn sau để xem dữ liệu</p>
</li>
</ol>
<pre tabindex="0"><code>SELECT count(*) as numberOfTransactions, sourceip
FROM &#34;tickettransactiondatabase&#34;.&#34;parquet_tickettransactionstreamingdata&#34; 
WHERE ingest_year=&#39;2024&#39;
AND cast(ingest_year as bigint)=year(now())
AND cast(ingest_month as bigint)=month(now())
AND cast(ingest_day as bigint)=day_of_month(now())
AND cast(ingest_hour as bigint)=hour(now())
GROUP BY sourceip
Order by numberOfTransactions DESC;
</code></pre>




<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/2-lab1/2.2-lab/" title="Lab"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/2-lab1/2.4-kinesis/" title="Real-time Streaming with Kinesis" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1713922703"></script>
    <script src="/js/perfect-scrollbar.min.js?1713922703"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1713922703"></script>
    <script src="/js/jquery.sticky.js?1713922703"></script>
    <script src="/js/featherlight.min.js?1713922703"></script>
    <script src="/js/highlight.pack.js?1713922703"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/js/modernizr.custom-3.6.0.js?1713922703"></script>
    <script src="/js/learn.js?1713922703"></script>
    <script src="/js/hugo-learn.js?1713922703"></script>

    <link href="/mermaid/mermaid.css?1713922703" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1713922703"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-158079754-2', 'auto');
  ga('send', 'pageview');

</script>
  </body>
</html>
